/*! Honey.js by Adam Timberlake created on 2013-06-24 */
Honey.Collection={modelMapper:{},create:function(a,b){var c=[],d=a||[];return c.add=function(a){Honey.Collection.Methods.add.call(b,a,this)},c.remove=function(a){Honey.Collection.Methods.remove.call(b,a,this)},d.forEach(function(a){var b=this.modelId();a.model=b,this.modelMapper[b]=a,c.push(a)},this),c},modelId:function(){var a,b=Math.round(1e4*Math.random()),c=Math.round(1e4*Math.random());do a=[].concat(b,(new Date).getTime(),c).join("-");while(Honey.Collection.modelMapper[a]);return a},Methods:{add:function(a,b){var c=Honey.Collection.modelId();a.model=c,Honey.Collection.modelMapper[c]=a,b.push(a),this.view.render()},remove:function(a,b){for(var c in b)b.hasOwnProperty(c)&&b[c].model===a.model&&b.splice(c,1);this.view.render()}}},Honey.Controller={extend:function(a){var b=function(){var b=this;this.buffer={};var c=function(a){b.propagateChanges.call(b,this,a)},d=function(){return b.view[this]};for(var e in a)a.hasOwnProperty(e)&&(Array.isArray(a[e])&&(a[e]=Honey.Collection.create(a[e],b)),Object.defineProperty(this,e,{set:c.bind(e),get:d.bind(e)}),this[e]=a[e]);Object.defineProperty(this,"_view",{set:function(a){b.attachedView.call(b,a)}})};return b.prototype=Honey.Controller.Methods,b},Methods:{invokeConstructor:function(){"function"==typeof this.constructor&&this.constructor()},propagateChanges:function(a,b){return this.view?(this.view[a]=b,this.view.render(),void 0):(this.buffer[a.valueOf()]=b,void 0)},attachedView:function(a){this.view=a;for(var b in this.buffer)this.buffer.hasOwnProperty(b)&&(this[b]=this.buffer[b]);delete this.buffer}}};var Honey={create:function(){return new Honey.Application},assert:function(a,b){if(!b)throw new Error("Hey! "+a+", honey.")},Application:function(){var a=function(a){return a.match(new RegExp(/([A-Z]{1}[a-z]+)$/g))[0].toLowerCase()},b=function(b){var c,d=[];for(var e in b){var f;if(b.hasOwnProperty(e))if("view"===a(e)){var g=Honey.Utils.getTemplateName(e),h=document.querySelector('[data-template-name="'+g+'"]'),i=document.evaluate("ancestor::*",h),j=0;do c=i.iterateNext(),j++;while(c);f={Class:b[e],name:e,ancestors:j},d.push(f)}else d.push({Class:b[e],name:e,ancestors:0})}return d.sort(function(a,b){return b.ancestors-a.ancestors})};document.addEventListener("DOMContentLoaded",function(){var c=b(this);for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];switch(a(e.name)){case"controller":Honey.Factory.createController(e);break;case"view":Honey.Factory.createView(e)}}var f=Honey.Factory.getViews();for(var g in f)if(f.hasOwnProperty(g)){var h=Honey.Factory.getView(g);h.renderable=!0,h.render()}}.bind(this),!1)}};Honey.Factory={_controllers:{},_views:{},getControllers:function(){return this._controllers},getViews:function(){return this._views},getController:function(a){return this._controllers[a]},getView:function(a){return this._views[a]},createView:function(a){var b,c,d=a.Class,e=a.name;return b=new d,b.name=e,b.toString=function(){return"[view "+e+"]"},this._views[a.name]=b,b.invokeConstructor(),c=Honey.Factory.getController(Honey.Utils.getControllerByView(e)),c&&(c._view=b,b.controller=c),b},createController:function(a){var b,c,d=a.Class,e=a.name;return c=new d,c.name=e,c.toString=function(){return"[controller "+e+"]"},this._controllers[e]=c,c.invokeConstructor(),b=Honey.Factory.getView(Honey.Utils.getViewByController(e)),b&&(b.controller=c,c._view=b),c}},Honey.Utils={getControllerByView:function(a){return a.replace(/View/,"Controller")},getViewByController:function(a){return a.replace(/Controller/,"View")},getTemplateName:function(a){return a.match(new RegExp(/^([A-Z]{1}[a-z]+)/g))[0].toLowerCase()},getControllerByTemplateName:function(a){var b=a.charAt(0).toUpperCase()+a.slice(1);return b+"Controller"}},Honey.View={templates:{},extend:function(a){var b=function(){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this.renderable=!1};return b.prototype=Honey.View.Methods,b},Methods:{template:null,invokeConstructor:function(){"function"==typeof this.constructor&&this.constructor()},constructor:function(){var a=Honey.Utils.getTemplateName(this.name),b=document.querySelector('[data-template-name="'+a+'"]'),c=function(a,b){var c=b.target.getAttribute("data-"+a),d=b.target.getAttribute("data-model")||null;if(c){var e=document.evaluate("ancestor-or-self::section[@data-template-name]",b.target).iterateNext(),f=e.getAttribute("data-template-name"),g=Honey.Utils.getControllerByTemplateName(f),h=Honey.Factory.getController(g);Honey.assert("You must specify the `"+c+"` event on the `"+g+"`",!!h[c]),h[c].apply(h,[b,Honey.Collection.modelMapper[d]])}},d=["click","dblclick","mouseover","mouseleave"];d.forEach(function(a){b.addEventListener(a,function(b){c(a,b)})})},render:function(){if(this.renderable){var a=Honey.Utils.getTemplateName(this.name),b=document.querySelector('[data-template-name="'+a+'"]');if(!this.template){var c,d=document.evaluate("section",b),e=[];do c=d.iterateNext(),c&&e.push(c);while(c);e.forEach(function(a){var b=a.getAttribute("data-template-name");a.innerHTML="{{{"+b+"Template}}}"}),this.template=document.querySelector('[data-template-name="'+a+'"]').innerHTML}var f=this,g=Honey.View.templates;for(var h in g)g.hasOwnProperty(h)&&(f[h]=g[h]);var i=Mustache.render(this.template,f);Honey.View.templates[a+"Template"]=i,b.innerHTML=i}}}};